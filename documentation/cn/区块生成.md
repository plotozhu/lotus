



## 区块生成 
### 候选人节点
1. 在新区块到达时，节点计算得到$\pi=sig_{m}(R)$后，计算$op = \frac {\pi}{2^{256}} \div \frac {P_{m}}{P_{all}}$, 计算延时函数$D=a + b\times log_{10}(op)$, $\pi$越大,延时越大,ab是用来调整延时因子的参数。此时节点处于准备投票状态(PREPARING)
2. 如果在延时时间内没有收到新的区块，那么节点根据上一轮的R值，计算得到 代理人，分别向代理人发送投票请求，节点进入等待投票状态(WAITING)
3. 节点收到代理人的投票，根据投票的结果计算权重。并且根据权重进入开始延时BLOCKING
4. 节点如果继续收到代理人的投票，重新计算权重，并且根据权重再次计算延时
5. 节点如果超时，就出块，状态转换到PREPARING
6. 节点如果收到比自身权重更高的区块，就放弃当前的定时器，状态转换到PREPARING

权重延时的计算公式：首先是权重公式：
 $$ 
    W = (M-V) * Prior * 100
 $$
 * 此处的$W$是权重，$M$是代理人总数，$Prior$是优先顺位，$V$是该优先顺位的投票者数量，Prior小的V不为0时，只计算小的，即如果Prior 1中有投票时，不计算其他Prior的信息， 显然W越小权重越高。
 
 其次是延时公式：
$$

\left
$$

### 代理人节点